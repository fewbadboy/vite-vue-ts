# Design

## 登录

- 密码 + MFA 安全增益相对高
- IP（经过反向代理，代理服务器会添加到一个请求头中，如 X-Real-IP）

### 判断权限

```md
graph TD
  A[用户访问任意路由] --> B{是否有 Token?}
  B -- 无 --> C[跳转 /login]
  B -- 有 --> D{是否已加载动态路由?}
  D -- 否 --> E[调用 API 获取菜单/路由]
  E --> F[addRoute 添加动态路由]
  F --> G[重新跳转原目标路由]
  D -- 是 --> H{目标路由是否存在?}
  H -- 不存在 --> I[跳转 404]
  H -- 存在 --> J{用户是否有权限?}
  J -- 无 --> K[跳转 403 或首页]
  J -- 有 --> L[允许进入]
```

## 路由

- 静态 + 动态 + NotFound
